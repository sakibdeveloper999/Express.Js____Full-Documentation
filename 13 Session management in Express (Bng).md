
# ЁЯУШ **Express.js-ржП рж╕рзЗрж╢ржи ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ тАФ рж╕ржорзНржкрзВрж░рзНржг ржбржХрзБржорзЗржирзНржЯ ржмрж╛ржВрж▓рж╛**

---

## рззя╕ПтГг рж╕рзЗрж╢ржи ржХрж┐ тАФ ржмрзНржпрж╛ржЦрзНржпрж╛

HTTP рж╣ржЪрзНржЫрзЗ **stateless** тАФ ржЕрж░рзНржерж╛рзО ржкрзНрж░рждрж┐ржЯрж┐ ржЕржирзБрж░рзЛржз ржЖрж▓рж╛ржжрж╛ ржоржирзЗ рж╣ржпрж╝ред ржПржХржЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржмрж┐ржнрж┐ржирзНржи ржЕржирзБрж░рзЛржзрзЗ рж╢ржирж╛ржХрзНржд рж░рж╛ржЦрждрзЗ Express рж╕рж╛ржзрж╛рж░ржгржд ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ:

* **Session ID** тАФ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ рж╕рж╛ржЗржбрзЗ ржХрзБржХрж┐ рж╣рж┐рж╕рзЗржмрзЗ рж░рж╛ржЦрж╛ред
* **Session Data** тАФ рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ (memory / Redis / MongoDB ржЗрждрзНржпрж╛ржжрж┐)ред

ржЕрждржПржм, ржПржХржЯрж┐ рж╕рзЗрж╢ржи рж╣ржЪрзНржЫрзЗ **ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ + рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржорж┐рж▓рж┐ржд ржмрзНржпржмрж╕рзНржерж╛**:

### тЬж ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ рж╕рж╛ржЗржб

ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ рж░рж╛ржЦрж╛ рж╣ржпрж╝ ржПржХржЯрж┐ ржЫрзЛржЯ ржХрзБржХрж┐, ржЙржжрж╛рж╣рж░ржг:

```
sid=ajd892h91h1...
```

ржХрзБржХрж┐рждрзЗ рж╕рж╛ржзрж╛рж░ржгржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржбрзЗржЯрж╛ ржерж╛ржХрзЗ ржирж╛ тАФ рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржХржЯрж┐ рж░тАМрзНржпрж╛ржирзНржбржо ржЖржЗржбрж┐ ржерж╛ржХрзЗред

### тЬж рж╕рж╛рж░рзНржнрж╛рж░ рж╕рж╛ржЗржб

рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╕рзЗрж╢ржирзЗрж░ ржиржорзБржирж╛ ржбрж╛ржЯрж╛:

```json
{
  "sid": "ajd892h91h1...",
  "data": {
    "userId": 7,
    "cart": ["item1", "item2"],
    "csrfToken": "x3e09...",
    "flash": "Welcome back!"
  },
  "expires": 1699999999
}
```

ржХрзБржХрж┐рж░ SID-ржЗ ржжрзБржЗ ржкрж╛рж╢ржХрзЗ рж▓рж┐ржВржХ ржХрж░рзЗред

---

## рзия╕ПтГг Express ржХрж┐ржнрж╛ржмрзЗ рж╕рзЗрж╢ржи рждрзИрж░рж┐ ржУ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ? (ржЕржнрзНржпржирзНрждрж░рзАржг ржлрзНрж▓рзЛ)

### тЪЩя╕П **рж╕рзЗрж╢ржи рждрзИрж░рж┐рж░ ржзрж╛ржк**

1. ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржержоржмрж╛рж░ рж╕рж╛ржЗржЯрзЗ ржЖрж╕рзЗред
2. `express-session` ржжрзЗржЦрзЗ ржХрзБржХрж┐ ржирзЗржЗред
3. ржПржХржЯрж┐ **session object** ржУ **session ID (sid)** рждрзИрж░рж┐ ржХрж░рзЗред
4. рж╕рзЗрж╢ржи ржЕржмржЬрзЗржХрзНржЯржЯрж┐ **session store**-ржП рж╕рзЗржн ржХрж░рзЗред
5. ржХрзБржХрж┐ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯрзЗ ржкрж╛ржарж╛ржпрж╝:

```
Set-Cookie: sid=s%3Aabc123def...; HttpOnly; Path=/
```

---

## рзйя╕ПтГг рж╕рзЗрж╢ржи рж▓рж╛ржЗржлрж╕рж╛ржЗржХрзЗрж▓ тАФ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд

### ЁЯФ╣ **Creation (рждрзИрж░рж┐ рж╣ржУржпрж╝рж╛)**

* рждржЦржиржЗ рж╕рзЗрж╢ржи рждрзИрж░рж┐ рж╣ржпрж╝ ржпржЦржи ржЖржкржирж┐ `req.session`-ржП ржХрж┐ржЫрзБ рж╕рзЗржЯ ржХрж░рзЗржи **ржПржмржВ** `saveUninitialized: false` рж╕рзЗржЯ ржХрж░рж╛ ржирж╛ржУ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред

### ЁЯФ╣ **Modification (ржкрж░рж┐ржмрж░рзНрждржи)**

```js
req.session.userId = 10;
```

ржПржнрж╛ржмрзЗ ржмржжрж▓рж╛рж▓рзЗ Express рж╕рзЗржЯрж┐ рж╕рзЗрж░рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рзЗ рж╕рзНржЯрзЛрж░рзЗ ржЖржкржбрзЗржЯ ржХрж░рзЗред

### ЁЯФ╣ **Persistence (ржЯрзЗржХрж╕ржЗ ржерж╛ржХрж╛)**

ржкрзНрж░рждрж┐ржЯрж┐ ржЕржирзБрж░рзЛржзрзЗ:

* ржХрзБржХрж┐ ржерзЗржХрзЗ sid ржкржбрж╝рзЗ,
* Express рж╕рзНржЯрзЛрж░ ржерзЗржХрзЗ рж╕рзЗрж╢ржи рж▓рзЛржб ржХрж░рзЗ `req.session`-ржП рж░рж╛ржЦрзЗред

### ЁЯФ╣ **Expiration (ржорзЗржпрж╝рж╛ржж рж╢рзЗрж╖)**

ржирж┐ржпрж╝ржирзНрждрзНрж░рж┐ржд рж╣ржпрж╝ `cookie.maxAge` ржПржмржВ рж╕рзНржЯрзЛрж░рзЗрж░ TTL ржжрж┐рзЯрзЗред ржорзЗржпрж╝рж╛ржж рж╢рзЗрж╖ рж╣рж▓рзЗ ржХрзБржХрж┐/рж╕рзЗрж╢ржи ржЕржмрзИржз рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ ржПржмржВ рж╕рзНржЯрзЛрж░ ржорзБржЫрзЗ ржжрзЗржпрж╝рж╛ рж╣ржпрж╝ред

### ЁЯФ╣ **Regeneration (ржкрзБржиржГржЙрждрзНржкрж╛ржжржи)**

рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐рж░ ржЙржжрзНржжрзЗрж╢рзНржпрзЗ ржмрзНржпржмрж╣рж╛рж░:

```js
req.session.regenerate(...)
```

ржирждрзБржи session ID рждрзИрж░рж┐ ржХрж░рзЗ (ржЕржзрж┐ржХрж╛рж░/рж▓ржЧржЗржи ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ рж╕ржоржпрж╝ ржмрзНржпржмрж╣рж╛рж░рзАржпрж╝)ред

### ЁЯФ╣ **Destruction (ржзрзНржмржВрж╕/рж▓ржЧржЖржЙржЯ)**

рж▓ржЧржЖржЙржЯ ржХрж░рж▓рзЗ:

```js
req.session.destroy()
```

---

## рзкя╕ПтГг `express-session` ржЕржкрж╢ржирж╕ржорзВрж╣ тАФ ржкрзБрж░рзЛ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

```js
app.use(session({
  name: 'sid',
  secret: 'your-secret',
  resave: false,
  saveUninitialized: false,
  cookie: {...},
  store: new RedisStore()
}));
```

ржПржЦржи ржкрзНрж░рждрж┐ржЯрж┐ ржЕржкрж╢ржи ржмрзНржпрж╛ржЦрзНржпрж╛:

### ЁЯФ╕ `name`

ржХрзБржХрж┐рж░ ржирж╛ржо (ржбрж┐ржлрж▓рзНржЯ `connect.sid`) тАФ ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЬржирзНржп ржХрж╛рж╕рзНржЯржо ржирж╛ржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи, ржпрзЗржоржи `sid`ред

### ЁЯФ╕ `secret`

ржХрзБржХрж┐-рж╕рж╛ржЗржи ржХрж░рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд ржХрзАред

* ржжрзАрж░рзНржШ ржУ рж░тАМрзНржпрж╛ржирзНржбржо рж╣рждрзЗ рж╣ржмрзЗред
* `.env` ржерзЗржХрзЗ ржирж┐ржиред
* рж░рзЛрж▓рзЗрж╛ржЯрж┐ рж╕рж╛ржмржзрж╛ржирзЗ ржХрж░рзБржи (rotation)ред

### ЁЯФ╕ `resave`

* `true` рж╣рж▓рзЗ ржкрзНрж░рждрж┐ржЯрж┐ рж░рзЗрж╕ржкржирзНрж╕рзЗржЗ рж╕рзЗрж╢ржи рж╕рзНржЯрзЛрж░рзЗ ржЖржкржбрзЗржЯ рж╣ржмрзЗ (ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝)ред
* `false` рж╣рж▓рзЗ ржХрзЗржмрж▓ рж╕рзЗрж╢ржи ржкрж░рж┐ржмрж░рзНрждржи рж╣рж▓рзЗ рж╕рзЗржн рж╣ржмрзЗ тАФ рж╕рж╛ржзрж╛рж░ржгржд `false` рж╕рзБржкрж╛рж░рж┐рж╢ржХрзГрждред

### ЁЯФ╕ `saveUninitialized`

* `true` рж╣рж▓рзЗ ржЦрж╛рж▓рж┐ рж╕рзЗрж╢ржиржУ рждрзИрж░рж┐ ржХрж░рзЗ ржХрзБржХрж┐ ржкрж╛ржарж╛ржпрж╝ред
* `false` рж╣рж▓рзЗ ржХрзБржХрж┐ рждржЦржиржЗ рждрзИрж░рж┐ рж╣ржмрзЗ ржпржЦржи ржЖржкржирж┐ рж╕рзЗрж╢ржирзЗ ржХрж┐ржЫрзБ рж╕рзНржЯрзЛрж░ ржХрж░ржмрзЗржи (ржЙрждрзНрждрж░рж╛ржзрж┐ржХрж╛рж░рзА) тАФ ржПржЗржЯрж╛ржЗ рж╕рж╛ржзрж╛рж░ржгржд ржнрж╛рж▓рзЛред

### ЁЯФ╕ `cookie`

ржХрзБржХрж┐ ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ рждрж╛ ржирж┐ржпрж╝ржирзНрждрзНрж░ржг ржХрж░рзЗ:

| ржЕржкрж╢ржи             | ржХрж╛ржЬ                                                       |
| ---------------- | --------------------------------------------------------- |
| `httpOnly`       | ржЬрж╛ржнрж╛рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржХрзБржХрж┐ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛ (XSS ржкрзНрж░рждрж┐рж░рзЛржз) |
| `secure`         | ржХрзБржХрж┐ ржХрзЗржмрж▓ HTTPS-ржП ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ                              |
| `sameSite`       | CSRF ржЭрзБржБржХрж┐ ржХржорж╛ржпрж╝ (`lax`/`strict`/`none`)                  |
| `maxAge`         | ржХрзБржХрж┐рж░ ржорзЗржпрж╝рж╛ржж (ржорж┐рж▓рж┐рж╕рзЗржХрзЗржирзНржб)                                |
| `domain`, `path` | ржХрзЛржи ржбрзЛржорзЗржЗржи/ржкрж╛ржерзЗ ржХрзБржХрж┐ ржкрж╛ржарж╛ржмрзЗ                               |

---

## рзля╕ПтГг рж╕рзЗрж╢ржи рж╕рзНржЯрзЛрж░ ржбрж┐ржЬрж╛ржЗржи тАФ ржмрж┐рж╕рзНрждрзГржд ржмрж┐ржмрж░ржг

### ЁЯЪл ржбрж┐ржлрж▓рзНржЯ: `MemoryStore`

* рж╢рзБржзрзБржорж╛рждрзНрж░ ржбрзЗржн-ржЙржкржпрзЛржЧрзАред
* ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи ржирж╛: ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣рж▓рзЗ рж▓рж╕, рж╕рзНржХрзЗрж▓рж┐ржВ ржирж╛ ржХрж░рж╛ ржпрж╛ржпрж╝, ржорзЗржорж░рж┐ ржмрзГржжрзНржзрж┐ ржЗрждрзНржпрж╛ржжрж┐ред

---

### ЁЯЯб RedisStore тАФ ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗрж░ ржЬржирзНржп рж╕рзЗрж░рж╛

* ржжрзНрж░рзБржд, ржкрзНржпрж╛рж░рж╛рж▓рж╛рж▓ ржирзЛржбрзЗ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝, TTL рж╕рж╛ржкрзЛрж░рзНржЯ, ржЕржЯрзЛ-┌й┘Држ┐ржиржЖржкред ржЕржзрж┐ржХрж╛ржВрж╢ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж╕рзЗржЯржЖржкрзЗ Redis ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝ред

---

### ЁЯЯв MongoDB Store (`connect-mongo`)

* MongoDB-ржнрж┐рждрзНрждрж┐ржХ ржЕрзНржпрж╛ржк рж╣рж▓рзЗ рж╕рзБржмрж┐ржзрж╛; ржкрж╛рж░рж╕рж┐рж╕рзНржЯрзЗржирзНржЯ рж╕рзНржЯрзЛрж░ред

---

### ЁЯЯг MySQL/Postgres Stores

* `connect-session-sequelize`, `connect-pg-simple` ржЗрждрзНржпрж╛ржжрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝ тАФ рж░рж┐рж▓рзЗрж╢ржирж╛рж▓ рж╕рзБржмрж┐ржзрж╛ ржУ ACIDред

---

### ЁЯФ╡ File-based Store

* `session-file-store` тАУ ржЫрзЛржЯ ржкрзНрж░ржЬрзЗржХрзНржЯ ржмрж╛ ржбрзЗржн-ржЙржжрзНржжрзЗрж╢рзНржпрзЗ ржЙржкржпрзБржХрзНржд; рж╕рзНржХрзЗрж▓ржпрзЛржЧрзНржп ржиржпрж╝ред

---

## рзмя╕ПтГг рж╕рзЗрж╢ржи ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржирж┐ржпрж╝ржорж┐ржд ржкрзНржпрж╛ржЯрж╛рж░рзНржирж╕ржорзВрж╣

* **Authentication Sessions** тАФ `req.session.userId` рж░рж╛ржЦрзБржи, ржкрзБрж░рзЛ ржЗржЙржЬрж╛рж░ ржЕржмржЬрзЗржХрзНржЯ ржиржпрж╝ред
* **Shopping Cart** тАФ `req.session.cart = [...]`
* **Multi-step forms / Wizards** тАФ ржЕрж╕рзНржерж╛ржпрж╝рзА ржзрж╛ржкрзЗрж░ ржбрж╛ржЯрж╛ рж╕рзЗрж╢ржирзЗ рж░рж╛ржЦрзБржиред
* **Flash Messages** тАФ рж░рж┐-ржбрж╛ржЗрж░рзЗржХрзНржЯ ржкрж░ржмрж░рзНрждрзА рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ ржорзЗрж╕рзЗржЬ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржпред
* **CSRF Tokens** тАФ рж╕рзЗрж╢ржирзЗ CSRF ржЯрзЛржХрзЗржи рж░рзЗржЦрзЗ ржлрж░рзНржо рж╕рж╛ржмржорж┐рж╢ржи ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржиред

---

## рзня╕ПтГг рж╕рзЗрж╢ржи рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ тАФ ржкрзВрж░рзНржг ржбржХрзБржорзЗржирзНржЯ

ржирж┐ржЪрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржирж┐рж░рзНржжрзЗрж╢рж╛ржмрж▓рзА:

### ЁЯФТ рзз) Session Fixation ржкрзНрж░рждрж┐рж░рзЛржз

рж▓ржЧржЗржирзЗрж░ рж╕ржоржпрж╝ рж╕рзЗрж╢ржи ржкрзБржирж░рж╛ржпрж╝ ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзБржи:

```js
req.session.regenerate(...)
```

### ЁЯФТ рзи) `httpOnly` ржХрзБржХрж┐

ржЬрж╛ржнрж╛рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржерзЗржХрзЗ ржХрзБржХрж┐ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржмржирзНржз рж░рж╛ржЦрзЗ тАФ XSS ржерзЗржХрзЗ ржХрзБржХрж┐ ржЪрзБрж░рж┐ рж░рзЛржзрзЗ рж╕рж╣рж╛ржпрж╝ржХред

### ЁЯФТ рзй) `sameSite`

CSRF ржЭрзБржБржХрж┐ ржХржорж╛ржпрж╝:

* `lax` тАФ рж╕рж╛ржзрж╛рж░ржг ржХрзНрж╖рзЗрждрзНрж░рзЗ ржнрж╛рж▓
* `strict` тАФ рж╕ржмржЪрзЗржпрж╝рзЗ ржирж┐рж░рж╛ржкржж (ржХрж┐ржирзНрждрзБ UX-ржП рж╕рзАржорж╛ржмржжрзНржзрждрж╛)
* `none` тАФ ржХрзНрж░рж╕-ржбрзЛржорзЗржЗржи ржХрзБржХрж┐рж░ ржЬржирзНржп (HTTPS-рж╕рж╣)

### ЁЯФТ рзк) `secure: true`

ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ рж╕рж░рзНржмржжрж╛ ржЪрж╛рж▓рзБ рж░рж╛ржЦрзБржи (HTTPS ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ)ред

### ЁЯФТ рзл) рж╕ржВржХрзНрж╖рж┐ржкрзНржд TTL

рж╕рзЗрж╢ржи рж▓рж╕/ржЧрзЛржкржирзАржпрж╝рждрж╛рж░ ржжрж┐ржХ ржерзЗржХрзЗ ржЫрзЛржЯ рж╕ржоржпрж╝ ржнрж╛рж▓рзЛ (ржЙржЪрзНржЪ рж╕ржВржмрзЗржжржирж╢рзАрж▓ ржЕрзНржпрж╛ржкрзЗ)ред

### ЁЯФТ рзм) ржирзНржпрзВржирждржо ржбрзЗржЯрж╛ рж╕ржВрж░ржХрзНрж╖ржг

ржХржЦржиржЗ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб, рж╕ржорзНржкрзВрж░рзНржг ржЗржЙржЬрж╛рж░ ржЕржмржЬрзЗржХрзНржЯ ржмрж╛ ржмржбрж╝ ржкрзЗ-рж▓рзЛржб рж╕рзЗрж╢ржирзЗ рж░рж╛ржЦржмрзЗржи ржирж╛ред

### ЁЯФТ рзн) Redis (ржмрж╛ ржнрж╛рж▓рзЛ рж╕рзНржЯрзЛрж░) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи

рж╕рзНржкрж┐ржб ржУ TTL рж╕рзБржмрж┐ржзрж╛; ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ MemoryStore-ржП ржнрж░рж╕рж╛ ржХрж░ржмрзЗржи ржирж╛ред

---

## рзоя╕ПтГг рж╕рзЗрж╢ржи ржЖржЗржбрж┐ ржЬрзЗржирж╛рж░рзЗрж╢ржи (ржЕржнрзНржпржирзНрждрж░рзАржг ржЖржЪрж░ржг)

Express рж╕рж╛ржзрж╛рж░ржгржд `uid-safe` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рж┐ржХрж┐ржЙрж░ ржЖржЗржбрж┐ рждрзИрж░рж┐ ржХрж░рзЗ:

* рзирзк ржмрж╛ржЗржЯ рж░тАМрзНржпрж╛ржирзНржбржо
* base64 encode ржХрж░рзЗ
* ржХрзНрж░рж┐ржкрзНржЯрзЛржЧрзНрж░рж╛ржлрж┐ржХрзНржпрж╛рж▓рж┐ рж╕рзБрж░ржХрзНрж╖рж┐ржд

ржХрзБржХрж┐ ржжрзЗржЦрж╛ржпрж╝ рж╕рж╛ржЗржи ржХрж░рж╛ ржлрж░рзНржорзЗ:

```
s%3A<sid>.<signature>
```

`secret` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ signature рждрзИрж░рж┐ рж╣ржпрж╝ тАФ ржХрзБржХрж┐ ржЯрзЗржорзНржкрж╛рж░рж┐ржВ рж░рзЛржз ржХрж░рзЗред

---

## рзпя╕ПтГг рж╕рзЗрж╢ржи рж╕рзЗржнрж┐ржВ ржкрзНрж░рж╕рзЗрж╕ (ржЕрзНржпрж╛ржбржнрж╛ржирзНрж╕ржб)

ржЖржкржирж┐ ржпржЦржи рж╕рзЗрж╢ржи ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗржи:

```js
req.session.xyz = "value";
```

Express ржХрж░рзЗ:

1. рж╕рзЗрж╢ржиржХрзЗ **dirty** рж╣рж┐рж╕рзЗржмрзЗ ржЪрж┐рж╣рзНржирж┐ржд ржХрж░рзЗред
2. рж╕рзЗрж░рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рзЗ (JSON)ред
3. рж╕рзНржЯрзЛрж░рзЗ ржкрж╛ржарж╛ржпрж╝ред
4. рж╕рзНржЯрзЛрж░рзЗ TTL ржЖржкржбрзЗржЯ ржХрж░рзЗред

---

## ЁЯФЯ ржорж╛рж▓рзНржЯрж┐-рж╕рж╛рж░рзНржнрж╛рж░ ржкрж░рж┐ржмрзЗрж╢рзЗ рж╕рзЗрж╢ржи рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬрзЗрж╢ржи

рж╣рж░рж╛ржЗржЬржиржЯрж╛рж▓ рж╕рзНржХрзЗрж▓ ржХрж░рж▓рзЗ (multiple server instances) MemoryStore ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ рж╕рзЗрж╢ржи рж╣рж╛рж░рж╛ржмрзЗред
рж╕ржорж╛ржзрж╛ржи: Redis, MongoDB, SQL, ржмрж╛ ржЕржирзНржп рж╢рзЗржпрж╝рж╛рж░рзНржб рж╕рзНржЯрзЛрж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред (ржЕржержмрж╛ sticky sessions тАФ ржХрж┐ржирзНрждрзБ рж╕рзЗржЯрж┐ ржХржо ржЖржжрж░рзНрж╢)

---

## рззя╕ПтГгрззя╕ПтГг рж╕рзЗрж╢ржи ржбрж┐ржмрж╛ржЧрж┐ржВ (ржЕрзНржпрж╛ржбржнрж╛ржирзНрж╕ржб ржЯрж┐ржкрж╕)

ржбрж┐ржмрж╛ржЧ рж▓ржЧ ржЪрж╛рж▓рж╛рждрзЗ:

```bash
DEBUG=express-session node app.mjs
```

ржПрждрзЗ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗ:

* ржХрзБржХрж┐ рж╕рзЗржЯ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛
* рж╕рзЗрж╢ржи рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛
* рж╕рзЗрж╢ржи рж╕рзЗржн/рж▓рзЛржб рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛

---

## рззя╕ПтГгрзия╕ПтГг рж╕рж╛ржзрж╛рж░ржг рж╕ржорж╕рзНржпрж╛ ржПржмржВ рж╕ржорж╛ржзрж╛ржи

### тЭМ ржХрзБржХрж┐ рж╕рзЗржЯ рж╣ржЪрзНржЫрзЗ ржирж╛

* ржХрж╛рж░ржг: `secure: true` ржХрж┐ржирзНрждрзБ ржЖржкржирж╛рж░ ржбрзЗржн-рж╕рж╛рж░рзНржнрж╛рж░ HTTP ржП ржЪрж▓ржЫрзЗред
* рж╕ржорж╛ржзрж╛ржи: ржбрзЗржнрзЗ `secure: false` ржХрж░рзБржи, ржкрзНрж░рзЛржбрзЗ `true` рж░рж╛ржЦрзБржиред

### тЭМ рж╕рзЗрж╢ржи ржкрзНрж░рждрж┐ржЯрж┐ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ рж░рж┐рж╕рзЗржЯ рж╣ржЪрзНржЫрзЗ

* ржХрж╛рж░ржг: ржнрзБрж▓ `secret`, ржХрзБржХрж┐ ржирж╛ржо mismatch, ржмрж╛ рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЛржирзЛ ржХрж╛рж░ржгрзЗ рж╕рзЗрж╢ржи рж▓рзЛржб ржХрж░рждрзЗ ржкрж╛рж░ржЫрзЗ ржирж╛ред
* рж╕ржорж╛ржзрж╛ржи: `secret` ржарж┐ржХ ржЖржЫрзЗ ржХрж┐ржирж╛, ржХрзБржХрж┐ рж╕рзЗржЯ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржиред

### тЭМ рж╕рзЗрж╢ржи рж╕рзЗржн рж╣ржЪрзНржЫрзЗ ржирж╛

* `saveUninitialized: false` ржерж╛ржХрж▓рзЗ ржЖржкржирж┐ ржЕржмрж╢рзНржпржЗ рж╕рзЗрж╢ржирзЗ ржХрж┐ржЫрзБ рж▓рж┐ржЦржЫрзЗржи ржХрж┐ржирж╛ ржжрзЗржЦрзБржиред
* ржХржЦржиржУ ржХржЦржиржУ `resave`/`saveUninitialized` ржХржиржлрж┐ржЧрзБрж░рзЗрж╢ржирзЗрж░ ржХрж╛рж░ржгрзЗ ржЕржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд ржЖржЪрж░ржг рж╣ржпрж╝ред

### тЭМ ржЯрзНржпрж╛ржм ржХржиржлрзНрж▓рж┐ржХрзНржЯ

ржПржХрж╛ржзрж┐ржХ ржЯрзНржпрж╛ржм/ржЯрзНржпрж╛ржм-рж╕рзНржкрзЗрж╕рж┐ржлрж┐ржХ рж╕рзНржЯрзЗржЯ ржжрж░ржХрж╛рж░ рж╣рж▓рзЗ ржЖрж▓рж╛ржжрж╛ ржХрзАржЧрзБрж▓рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи (session ржХрзЗ ржкрзБрж░рзЛржкрзБрж░рж┐ ржирж┐рж░рзНржнрж░ржпрзЛржЧрзНржп рж╕рзНржЯрзЛрж░рзЗржЬ ржмрж╛ржирж╛ржмрзЗржи ржирж╛ UI-рж╢рзЗржкрзЗрж░ ржЬржирзНржп)ред

---

## рззя╕ПтГгрзйя╕ПтГг рж╕ржорзНржкрзВрж░рзНржг ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓ ржЙржжрж╛рж╣рж░ржг тАФ ржкрзВрж░рзНржг ржкрзНрж░ржЬрзЗржХрзНржЯ (ESM)

**ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ (ржЙржжрж╛рж╣рж░ржг):**

```
project/
  app.mjs
  auth.mjs
  routes/
  middleware/
  config/
```

**app.mjs (ржЙржжрж╛рж╣рж░ржг)**

```js
import express from "express";
import session from "express-session";
import connectMongo from "connect-mongo";

const app = express();

// MongoStore ржЙржжрж╛рж╣рж░ржг (ржХрж╛ржирзЗржХрж╢ржи ржЗржЙржЖрж░ржПрж▓ рж▓рж╛ржЧрзЗ)
const MongoStore = connectMongo.create({
  mongoUrl: "mongodb://localhost:27017/sessions",
  ttl: 60 * 60, // 1 hour
});

app.use(session({
  name: "sid",
  secret: "secret-key", // production-ржП `.env` ржерзЗржХрзЗ ржирж┐ржи
  resave: false,
  saveUninitialized: false,
  store: MongoStore,
  cookie: {
    httpOnly: true,
    secure: false,       // dev-ржП false, production-ржП true
    sameSite: "lax",
    maxAge: 1000 * 60 * 60 // 1 hour
  }
}));

app.get("/", (req, res) => {
  // ржнрж┐ржЬрж┐ржЯ ржХрж╛ржЙржирзНржЯрж╛рж░ ржЙржжрж╛рж╣рж░ржг
  req.session.count = (req.session.count || 0) + 1;
  res.send("Visits: " + req.session.count);
});

app.listen(3000);
```

---

## рззя╕ПтГгрзкя╕ПтГг рж╕рзЗрж╢ржи + ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи тАФ рж╢рзНрж░рзЗрж╖рзНржа ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░

1. ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж▓ржЧржЗржи ржХрж░рзЗред
2. рж╕рж╛рж░рзНржнрж╛рж░ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗред
3. рж▓ржЧржЗржирзЗрж░ ржкрж░рзЗ `req.session.regenerate()` ржЪрж╛рж▓рж╛ржпрж╝ (session fixation рж░рзЛржзрзЗ)ред
4. рж╕рзЗрж╢ржирзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ `userId`, `role`, `permissions`, `timestamp`тАФ ржЗрждрзНржпрж╛ржжрж┐ (рж╕рж░рзНржмржирж┐ржорзНржи ржжрж░ржХрж╛рж░рж┐)ред
5. рж╕ржорж╕рзНржд ржкрзНрж░рзЛржЯрзЗржХрзНржЯрзЗржб рж░рзБржЯ ржЪрзЗржХ ржХрж░рзЗ:

```js
if (!req.session.userId) reject();
```

---

## рззя╕ПтГгрзля╕ПтГг JWT ржмржирж╛ржо рж╕рзЗрж╢ржи тАФ ржкрзВрж░рзНржг рждрзБрж▓ржирж╛

|      ржмрж┐рж╖рзЯ | рж╕рзЗрж╢ржи                                    | JWT                                          |
| --------: | --------------------------------------- | -------------------------------------------- |
|     рж▓ржЧржЖржЙржЯ | рждрж╛рзОржХрзНрж╖ржгрж┐ржХ (session destroy)             | ржЕржмрж┐рж▓ржорзНржмрзЗ ржиржпрж╝ (token ржПржЦржиржУ ржнрзНржпрж╛рж▓рж┐ржб ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ) |
| Stateful? | рж╣рзНржпрж╛ржБ                                   | ржирж╛                                           |
|   рж╕рзНржХрзЗрж▓рж┐ржВ | рж╕рзНржЯрзЛрж░ ржжрж░ржХрж╛рж░                             | рж╕рж╣ржЬ (stateless)                              |
| рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ | рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА (рж░рж┐ржмрзЛржХрзЗрж╢ржи рж╕рж╣ржЬ)                | ржЯрзЛржХрзЗржи ржЪрзБрж░рж┐ рж╣рж▓рзЗ ржЭрзБржБржХрж┐ ржмрзЗрж╢рж┐                    |
|     ржЖржжрж░рзНрж╢ | ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржк ржпрзЗржЦрж╛ржирзЗ рж▓ржЬржЖржЙржЯ/рж░рж┐ржмрзЛржХрзЗрж╢ржи ржжрж░ржХрж╛рж░ | APIs, mobile clients, microservices          |

---

## рззя╕ПтГгрзмя╕ПтГг Flash Messages тАФ ржЧржнрзАрж░ ржмрзНржпрж╛ржЦрзНржпрж╛

рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ-ржкрж░ржмрж░рзНрждрзА ржорзЗрж╕рзЗржЬ ржжрзЗржЦрж╛рждрзЗ ржмрзНржпржмрж╣рзГржд рж╣рзЯ:

```js
req.session.flash = "Saved!";
```

ржкрж░ржмрж░рзНрждрзА рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ:

1. flash ржкржбрж╝рзБржи
2. ржкрж░рзЗ ржорзБржЫрзЗ ржжрж┐ржи
3. UI-рждрзЗ ржжрзЗржЦрж╛ржи

---

## рззя╕ПтГгрзня╕ПтГг CSR, SSR ржУ SPA-рж░ ржоржзрзНржпрзЗ рж╕рзЗрж╢ржи ржЖржЪрж░ржг

* **SSR (EJS, Pug)**: рж╕рзЗрж╢ржи ржХрж╛ржЬ ржХрж░ржмрзЗ рж╕рзНржмрж╛ржнрж╛ржмрж┐ржХржнрж╛ржмрзЗред
* **SPA (React, Vue)**: AJAX ржЕржирзБрж░рзЛржзрзЗрж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ `fetch`/`axios`-ржП `credentials: "include"` ржмрж╛ `withCredentials: true` рж╕рзЗржЯ ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛рждрзЗ ржХрзБржХрж┐ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝ред
* **CORS + Cookies**: ржХрзНрж░рж╕-ржбрзЛржорзЗржЗржирзЗ ржХрзБржХрж┐ ржкрж╛ржарж╛рждрзЗ рж╣рж▓рзЗ `sameSite: "none"` ржПржмржВ `secure: true` рж▓рж╛ржЧржмрзЗ ржПржмржВ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржХрзНрж░рж╕-ржЕрж░рж┐ржЬрж┐ржи рж╕рзЗржЯрж┐ржВрж╕ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред

---

## рззя╕ПтГгрзоя╕ПтГг ржкрж╛рж░ржлрж░рзНржорзНржпрж╛ржирзНрж╕ ржмрж┐ржмрзЗржЪржирж╛

* Redis рж╕ржмржЪрзЗржпрж╝рзЗ ржжрзНрж░рзБрждред
* ржмржбрж╝ ржЕржмржЬрзЗржХрзНржЯ рж╕рзЗрж╢ржирзЗ рж░рж╛ржЦржмрзЗржи ржирж╛ред
* TTL ржЫрзЛржЯ рж░рж╛ржЦрзБржи ржпрзЗржЦрж╛ржирзЗ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржЬрж░рзБрж░рж┐ред
* ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ рж░рж┐рж╕рзЗржн (resave) ржерзЗржХрзЗ ржмрж╛ржБржЪрзБржиред

---

## рззя╕ПтГгрзпя╕ПтГг рж╕рзЗрж╢ржи рж░рзЛржЯрзЗрж╢ржи рж╕рзНржЯрзНрж░рзНржпрж╛ржЯрзЗржЬрж┐ (ржЕрзНржпрж╛ржбржнрж╛ржирзНрж╕ржб)

ржирж┐ржпрж╝ржорж┐ржд рж╕рзЗрж╢ржи ID рж░рзЛржЯрзЗржЯ ржХрж░рзБржи (ржмрж╛ рж▓ржЧржЗржи/ржкрзНрж░рж┐ржнрж┐рж▓рзЗржЬ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ рж╕ржоржпрж╝) тАФ `req.session.regenerate()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржПржЯрж┐ ржжрзАрж░рзНржШ ржорзЗржпрж╝рж╛ржжрзА fixation ржЖржХрзНрж░ржоржг ржХржорж╛ржпрж╝ред

---

## рзия╕ПтГгрзжя╕ПтГг рж╕рзЗрж╢ржи ржПржиржХрзНрж░рж┐ржкрж╢ржи ржмржирж╛ржо рж╕рж╛ржЗржирж┐ржВ

### Signing (ржбрж┐ржлрж▓рзНржЯ)

* ржЗржирзНржЯрж┐ржЧрзНрж░рж┐ржЯрж┐ рж░ржХрзНрж╖рж╛ ржХрж░рзЗ тАФ ржХрзБржХрж┐ ржЯрзЗржорзНржкрж╛рж░ ржХрж░рж╛ ржЧрзЗрж▓рзЗ ржзрж░рж╛ ржпрж╛ржпрж╝ред
* ржХрж┐ржирзНрждрзБ ржХрзБржХрж┐рж░ ржХржирзНржЯрзЗржирзНржЯ ржкржбрж╝рж╛ рж╕ржорзНржнржм (ржпржжрж┐ рж░рж┐ржбрзЗржмрж▓ ржерж╛ржХрзЗ) тАФ рж╕рж╛ржзрж╛рж░ржиржд ржХрзБржХрж┐рждрзЗ data ржирж╛ рж░рж╛ржЦрж╛ржЗ ржнрж╛рж▓рзЛред

### Encryption (ржЗржЪрзНржЫрж╛ржХрзГржд)

* ржХрзБржХрж┐ рж╕ржорзНржкрзВрж░рзНржг ржПржиржХрзНрж░рж┐ржкрзНржЯ ржХрж░рж╛ ржпрж╛ржпрж╝ (рж░рж┐ржбрзЗржмрж▓ ржиржпрж╝)ред
* рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐: `iron` ржмрж╛ ржХрж╛рж╕рзНржЯржо ржПржиржХрзНрж░рж┐ржкрж╢ржи ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯред
* рж▓ржХрзНрж╖рзНржп: ржХрзБржХрж┐-ржнрж┐рждрзНрждрж┐ржХ рж╕рзЗрж╢ржи рждржерзНржп ржЧрзЛржкржи рж░рж╛ржЦрж╛ (ржХрж┐ржирзНрждрзБ рж╕рж╛ржзрж╛рж░ржгржд рж╕рж╛рж░рзНржнрж╛рж░-рж╕рж╛ржЗржб рж╕рзНржЯрзЛрж░ ржкрзНрж░рзЗржлрж╛рж░ ржХрж░рж╛ рж╣ржпрж╝)ред

---

## тнР ржЙржкрж╕ржВрж╣рж╛рж░

ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржПржЦржи рж░ржпрж╝рзЗржЫрзЗ рж╕ржорзНржкрзВрж░рзНржг, ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ ржЬрзНржЮрж╛ржи:

* рж╕рзЗрж╢ржи ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ (ржЕржнрзНржпржирзНрждрж░рзАржгржнрж╛ржмрзЗ),
* рж▓рж╛ржЗржлрж╕рж╛ржЗржХрзЗрж▓,
* рж╕рзНржЯрзЛрж░ ржзрж░ржирж╕ржорзВрж╣,
* рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржоржбрзЗрж▓,
* ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ ржУ рж╕рзНржХрзЗрж▓рж┐ржВ,
* ржбрж┐ржмрж╛ржЧрж┐ржВ,
* рж░рж┐ржпрж╝рзЗрж▓-ржУржпрж╝рж╛рж░рзНрж▓рзНржб ржЗржЙржЬржХрзЗрж╕,
* рж╕ржорзНржкрзВрж░рзНржг ржХрзЛржб ржЙржжрж╛рж╣рж░ржг ржЗрждрзНржпрж╛ржжрж┐ред

---
